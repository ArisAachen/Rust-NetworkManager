<mxfile host="app.diagrams.net" modified="2021-07-15T07:34:36.357Z" agent="5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36" etag="xtNRfJnS3YzwBouE_igt" version="14.8.6" type="github">
  <diagram id="JpKQY7Qc_Tq1k1H82ZDq" name="Page-1">
    <mxGraphModel dx="2120" dy="1931" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-45" value="调用dbus方法ActivateConnection&lt;br&gt;&lt;div&gt;impl_manager_activate_connection (NMDBusObject *obj,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; const NMDBusInterfaceInfoExtended *interface_info,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; const NMDBusMethodInfoExtended *method_info,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; GDBusConnection *dbus_connection,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; const char *sender,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; GDBusMethodInvocation *invocation,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; GVariant *parameters)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="-130" y="-330" width="510" height="130" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-46" value="解析dbus参数&amp;nbsp;&lt;br&gt;device_path 为设备dbus路径&amp;nbsp; &amp;nbsp;&lt;br&gt;connection_path 为激活连接的dbus路径&lt;br&gt;specific_object_path 为想要激活连接的AP路径或者VPN路径&lt;br&gt;&lt;br&gt;&lt;span&gt;	&lt;/span&gt;g_variant_get (parameters, &quot;(&amp;amp;o&amp;amp;o&amp;amp;o)&quot;, &amp;amp;connection_path, &amp;amp;device_path, &amp;amp;specific_object_path);" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="190" y="-170" width="530" height="100" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-47" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;/span&gt;如果调用参数包含&amp;nbsp;connection 路径参数，则从Settings中查找配置信息NMSettingsConnection&lt;br&gt;if (connection_path)&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;		&lt;/span&gt;sett_conn = nm_settings_get_connection_by_path (priv-&amp;gt;settings, connection_path);&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;		&lt;/span&gt;if (!sett_conn) {&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;			&lt;/span&gt;error = g_error_new_literal (NM_MANAGER_ERROR,&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;			&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NM_MANAGER_ERROR_UNKNOWN_CONNECTION,&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;			&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&quot;Connection could not be found.&quot;);&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;			&lt;/span&gt;goto error;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="250" y="-40" width="510" height="120" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-91" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;/span&gt;如果调用参数包含 不包含connection 路径参数，则从AvailableConnections中搜寻最合适的配置信息NMSettingsConnection&lt;br&gt;&lt;span&gt;		&lt;/span&gt;if (!device_path) {}&amp;nbsp; &amp;nbsp;// 如connection未指定，则必须指定device路径，如果不指定，则报错。&lt;br&gt;&lt;span&gt;		&lt;/span&gt;device = nm_manager_get_device_by_path (self, device_path)&amp;nbsp; //根据device路径，从NMManager中获取NMDevice&lt;br&gt;&lt;span&gt;		&lt;/span&gt;if (!device) {}&amp;nbsp; &amp;nbsp; // 如果找不到device路径设备，则报错&lt;br&gt;&lt;span&gt;		&lt;/span&gt;sett_conn = nm_device_get_best_connection (device, specific_object_path, &amp;amp;error)&amp;nbsp; //根据device，从设备的AvailableConnections中选取最合适的NMSettingsConnection&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="250" y="110" width="740" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-92" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;/span&gt;从AvailableConnections中搜寻最合适的配置信息NMSettingsConnection&lt;br&gt;&lt;div&gt;NMSettingsConnection *&lt;/div&gt;&lt;div&gt;nm_device_get_best_connection (NMDevice *self,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;const char *specific_object,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;GError **error)&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="250" width="410" height="100" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-93" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;/span&gt;如果调用参数包含&amp;nbsp;connection 路径参数，则从Settings中查找配置信息NMSettingsConnection&lt;br&gt;g_hash_table_iter_init (&amp;amp;iter, priv-&amp;gt;available_connections);&amp;nbsp; &amp;nbsp; &amp;nbsp;// 迭代器从available_connections第一个开始遍历&lt;br&gt;&lt;span&gt;	&lt;/span&gt;while (g_hash_table_iter_next (&amp;amp;iter, (gpointer) &amp;amp;candidate, NULL)) {&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp; 检查设备是否允许绑定到 connection 上, 如指定了 [connection] interface-name = xxx&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp; 或者 [802-3-ethernet]&amp;nbsp;mac-address 则说明此连接绑定了专门的设备，则必须与设备匹配&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;if (&amp;nbsp; &amp;nbsp; specific_object /* &amp;lt;&amp;lt; Optimization: we know that the connection is available without @specific_object.&amp;nbsp; */&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;&amp;amp; !nm_device_check_connection_available (self,&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;nm_settings_connection_get_connection (candidate),&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;_NM_DEVICE_CHECK_CON_AVAILABLE_FOR_USER_REQUEST,&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;specific_object,&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NULL))&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;continue;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// 尝试获取合适的配置中[connection]&amp;nbsp;timestamp 最大的作为最佳的设备&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// 这也意味着最近连接成功的配置为最佳的配置&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;nm_settings_connection_get_timestamp (candidate, &amp;amp;candidate_timestamp);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;}&lt;br&gt;&lt;span&gt;	&lt;/span&gt;if (!sett_conn) { }&amp;nbsp; &amp;nbsp; // 如果始终找不到，则报错&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="930" y="380" width="610" height="250" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-95" value="&lt;span&gt;构建NMAuthSubject，主要用于调用Polkit认证&lt;br&gt;如果指定了device_path，则直接查找&lt;br&gt;如果没有指定device，则根据connection找到最适合的NMDevice&lt;br&gt;subject = validate_activation_request (self,&lt;/span&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;invocation,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;sett_conn,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NULL,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;device_path,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;is_vpn,&lt;/div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;error);&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="190" y="420" width="350" height="160" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-96" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;verticalAlign=top;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-45" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-60" y="80" as="sourcePoint" />
            <mxPoint x="125" y="2340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-98" value="Text" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="AloPbkMcbUFJ7XGDn3WE-96" vertex="1" connectable="0">
          <mxGeometry x="-0.924" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-99" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="AloPbkMcbUFJ7XGDn3WE-46" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="-120" as="sourcePoint" />
            <mxPoint x="90" y="-140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-100" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="AloPbkMcbUFJ7XGDn3WE-47" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="180" y="20" as="sourcePoint" />
            <mxPoint x="20" y="70" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-101" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="AloPbkMcbUFJ7XGDn3WE-91" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="180" y="165" as="sourcePoint" />
            <mxPoint x="320" y="310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-102" value="if(connection_path)" style="endArrow=none;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="180" y="170" as="sourcePoint" />
            <mxPoint x="180" y="20" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-103" value="" style="endArrow=none;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="90" as="sourcePoint" />
            <mxPoint x="180" y="90" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-104" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-91" target="AloPbkMcbUFJ7XGDn3WE-92" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="360" as="sourcePoint" />
            <mxPoint x="570" y="310" as="targetPoint" />
            <Array as="points">
              <mxPoint x="620" y="300" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-105" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=none;rounded=0;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-92" target="AloPbkMcbUFJ7XGDn3WE-93" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="730" y="510" as="sourcePoint" />
            <mxPoint x="780" y="460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="885" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-106" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-92" target="AloPbkMcbUFJ7XGDn3WE-93" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="820" y="560" as="sourcePoint" />
            <mxPoint x="870" y="510" as="targetPoint" />
            <Array as="points">
              <mxPoint x="885" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-107" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="AloPbkMcbUFJ7XGDn3WE-95" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="500" as="sourcePoint" />
            <mxPoint x="-10" y="780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-109" value="&lt;span&gt;构建NMAuthSubject，主要用于调用Polkit认证&lt;br&gt;如果没有指定device，则根据connection找到最适合的NMDevice&lt;br&gt;&lt;div&gt;static NMAuthSubject *&lt;/div&gt;&lt;div&gt;validate_activation_request (NMManager *self,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;GDBusMethodInvocation *context,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NMSettingsConnection *sett_conn,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NMConnection *connection,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;const char *device_path,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NMDevice **out_device,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gboolean *out_is_vpn,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;GError **error)&lt;/div&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="400" y="610" width="360" height="160" as="geometry" />
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-111" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-95" target="AloPbkMcbUFJ7XGDn3WE-109" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="1060" as="sourcePoint" />
            <mxPoint x="350" y="1010" as="targetPoint" />
            <Array as="points">
              <mxPoint x="365" y="690" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AloPbkMcbUFJ7XGDn3WE-113" value="&lt;span&gt;// 如果参数没有指定NMConnection，则从setting转化&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;if (!connection)&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;connection = nm_settings_connection_get_connection (sett_conn)&lt;br&gt;// 构建 指定 uid pid 的Polkit subject对象&lt;br&gt;&lt;span&gt;	&lt;/span&gt;subject = nm_auth_subject_new_unix_process_from_context (context);&lt;br&gt;// 如果存在device_path，此函数通常是由于指定了connection连接时，会处理&lt;br&gt;&lt;div&gt;if (device_path) {&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;device = nm_manager_get_device_by_path (self, device_path)&lt;/div&gt;&lt;div&gt;// 非vpn连接，如果指定了connection，未指定device_path，还可以自动查找最佳设备&lt;br&gt;if (!is_vpn) {&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;//&amp;nbsp; 如果指定了connection，却不指定device_path，则自动查找最佳设备&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span&gt;&lt;span&gt;	&lt;/span&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;device = nm_manager_get_best_device_for_connection (self, sett_conn,&lt;span&gt;	&lt;/span&gt; &lt;span&gt;	&lt;/span&gt;connection, TRUE, NULL, &amp;amp;local);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&lt;span&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;if (!device) {&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;			&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/span&gt;if (!nm_connection_is_virtual (connection)) {&lt;/span&gt;&lt;span&gt;}&amp;nbsp; // 如果没有指定device，且找不到最佳设备，则可以根据&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;iface查找设备，但是此设备不能为虚拟的&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/span&gt;// 从Manager中查找 [connection] interface-name 指定的设备&lt;br&gt;&lt;span&gt;			&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/span&gt;iface = nm_manager_get_connection_iface (self, connection, NULL, error);&lt;br&gt;&lt;span&gt;			&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/span&gt;device = find_device_by_iface (self, iface, connection, NULL);&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/span&gt;if (!device) {}&amp;nbsp; &amp;nbsp;// 如果无论如何都找不到设备，则报错&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="620" y="810" width="610" height="310" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-109" target="AloPbkMcbUFJ7XGDn3WE-113" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="1130" as="sourcePoint" />
            <mxPoint x="540" y="1080" as="targetPoint" />
            <Array as="points">
              <mxPoint x="580" y="965" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-2" value="&lt;div&gt;根据连接配置查找最佳设备&lt;/div&gt;&lt;div&gt;static NMDevice *&lt;/div&gt;&lt;div&gt;nm_manager_get_best_device_for_connection (NMManager *self,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NMSettingsConnection *sett_conn,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NMConnection *connection,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gboolean for_user_request,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;GHashTable *unavailable_devices,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;GError **error)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="970" y="1160" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-3" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="AloPbkMcbUFJ7XGDn3WE-113" target="qgWzMEBjYxOlB0a452hM-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="830" y="1460" as="sourcePoint" />
            <mxPoint x="880" y="1410" as="targetPoint" />
            <Array as="points">
              <mxPoint x="925" y="1220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-4" value="&lt;div&gt;根据连接配置查找最佳设备&lt;br&gt;// 查看改配置文件是否允许多个设备激活使用&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;multi_connect =&amp;nbsp; _nm_connection_get_multi_connect (connection)&lt;br&gt;// 是否是用户请求的&lt;br&gt;&lt;div&gt;if (!for_user_request)&lt;/div&gt;&lt;div&gt;&lt;span&gt;		&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;flags = NM_DEVICE_CHECK_CON_AVAILABLE_NONE;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1210" y="1320" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-5" value="&lt;span&gt;构建激活对象，主要用于认证成功后回调_async_op_complete_ac_auth_cb进行激活连接，并保存激活的原因为用户激活&lt;br&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;active = _new_active_connection (self,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;is_vpn,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;sett_conn,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NULL,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NULL,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;specific_object_path,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;device,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;subject,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NM_ACTIVATION_TYPE_MANAGED,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NM_ACTIVATION_REASON_USER_REQUEST,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;error);&lt;/div&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="190" y="1160" width="440" height="200" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-6" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="qgWzMEBjYxOlB0a452hM-5" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="1260" as="sourcePoint" />
            <mxPoint x="310" y="1430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-8" value="&lt;span&gt;构建激活对象，主要用于认证成功后回调_async_op_complete_ac_auth_cb进行激活连接，并保存激活的原因为用户激活&lt;br&gt;&lt;div&gt;&lt;div&gt;static NMActiveConnection *&lt;/div&gt;&lt;div&gt;_new_active_connection (NMManager *self,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gboolean is_vpn,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMSettingsConnection *sett_conn,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMConnection *incompl_conn,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMConnection *applied,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; const char *specific_object,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMDevice *device,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMAuthSubject *subject,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMActivationType activation_type,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMActivationReason activation_reason,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; GError **error)&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="510" y="1410" width="440" height="200" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-9" value="" style="endArrow=classic;html=1;exitX=0.519;exitY=1.011;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="qgWzMEBjYxOlB0a452hM-5" target="qgWzMEBjYxOlB0a452hM-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="1830" as="sourcePoint" />
            <mxPoint x="540" y="1780" as="targetPoint" />
            <Array as="points">
              <mxPoint x="418" y="1510" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-10" value="&lt;span&gt;构建激活对象，主要用于认证成功后回调_async_op_complete_ac_auth_cb进行激活连接，并保存激活的原因为用户激活&lt;br&gt;&lt;div&gt;&lt;div&gt;s&lt;span&gt;	&lt;/span&gt;&lt;span&gt;if (is_vpn) { }&amp;nbsp; &amp;nbsp; &amp;nbsp; // vpn进行额外的操作，创建VPN ActivateConnection对象&lt;br&gt;&lt;br&gt;// 构建ActivteConnection对象&lt;br&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;return (NMActiveConnection *) nm_act_request_new (sett_conn,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; applied,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; specific_object,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; subject,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; activation_type,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; activation_reason,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device);&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="780" y="1650" width="440" height="180" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-12" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="qgWzMEBjYxOlB0a452hM-8" target="qgWzMEBjYxOlB0a452hM-10" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="640" y="2050" as="sourcePoint" />
            <mxPoint x="690" y="2000" as="targetPoint" />
            <Array as="points">
              <mxPoint x="730" y="1740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-13" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" source="qgWzMEBjYxOlB0a452hM-2" target="qgWzMEBjYxOlB0a452hM-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1270" y="1610" as="sourcePoint" />
            <mxPoint x="1320" y="1560" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1150" y="1380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-14" value="&lt;span&gt;开启Polkit认证，并回调处理认证结果，指定认证类型为ASYNC_OP_TYPE_AC_AUTH_ACTIVATE_USER，意思是激活已存在的配置文件，非创建并激活&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;nm_active_connection_authorize (active,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NULL,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; _async_op_complete_ac_auth_cb,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; _async_op_data_new_ac_auth_activate_user (self,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; active,&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; invocation));&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="190" y="1850" width="420" height="130" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-15" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="qgWzMEBjYxOlB0a452hM-14" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="120" y="1915" as="sourcePoint" />
            <mxPoint x="360" y="1740" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-17" value="&lt;span&gt;构建认证结构成功后的返回数据结构，记录当前的ActiveConnection&lt;br&gt;记录认证的类型为ASYNC_OP_TYPE_AC_AUTH_ACTIVATE_USER&lt;br&gt;&lt;/span&gt;&lt;span&gt;static AsyncOpData *&lt;/span&gt;&lt;div&gt;_async_op_data_new_ac_auth_activate_user (NMManager *self,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMActiveConnection *active_take,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; GDBusMethodInvocation *invocation_take)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="460" y="2020" width="420" height="90" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-18" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=0;" parent="1" source="qgWzMEBjYxOlB0a452hM-14" target="qgWzMEBjYxOlB0a452hM-17" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="2220" as="sourcePoint" />
            <mxPoint x="370" y="2170" as="targetPoint" />
            <Array as="points">
              <mxPoint x="400" y="2065" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-19" value="&lt;span&gt;构建认证结构成功后的返回数据结构，记录当前的ActiveConnection&lt;br&gt;// 记录当前的认证类型为用户直接激活，非创建激活&lt;br&gt;&lt;span&gt;	&lt;/span&gt;async_op_data-&amp;gt;async_op_type = ASYNC_OP_TYPE_AC_AUTH_ACTIVATE_USER;&lt;br&gt;// 保存认证的ActiveConnection对象&lt;br&gt;async_op_data-&amp;gt;ac_auth.active = active_take;&lt;br&gt;// 函数句柄&lt;br&gt;async_op_data-&amp;gt;ac_auth.activate_user.invocation = invocation_take;&lt;br&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="720" y="2150" width="470" height="100" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-20" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=0;" parent="1" source="qgWzMEBjYxOlB0a452hM-17" target="qgWzMEBjYxOlB0a452hM-19" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="2360" as="sourcePoint" />
            <mxPoint x="550" y="2310" as="targetPoint" />
            <Array as="points">
              <mxPoint x="670" y="2200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-21" value="" style="endArrow=classic;html=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="2060" as="sourcePoint" />
            <mxPoint x="400" y="2700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-22" value="&lt;span&gt;调用Polkit进行认证，并在认证后进行回调&lt;br&gt;&lt;/span&gt;&lt;div&gt;void&lt;/div&gt;&lt;div&gt;nm_active_connection_authorize (NMActiveConnection *self,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMConnection *initial_connection,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NMActiveConnectionAuthResultFunc result_func,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gpointer user_data)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="720" y="2300" width="380" height="92" as="geometry" />
        </mxCell>
        <mxCell id="qgWzMEBjYxOlB0a452hM-23" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=0;" parent="1" target="qgWzMEBjYxOlB0a452hM-22" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="670" y="2200" as="sourcePoint" />
            <mxPoint x="640" y="2410" as="targetPoint" />
            <Array as="points">
              <mxPoint x="670" y="2346" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
